<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>dms-logchain</title>
    <link rel="stylesheet" href="./style.css">
    <link rel="icon" href="./favicon.ico" type="image/x-icon">

  </head>
  <body>
      <div id="consentBox">
        <img src="" alt="Logo">
        <div id="consentContent">
            <header id="consentHeader">
                  dms-cookies
              </header>
            <p>
              We use cookies to monitor for sign of life.
              <br>The cookies are necessary for site to function and are anonymous.
            </p>
            <div class="buttons">
                <button class="consentButton">
                      Accept Cookies
                  </button>
                <button class="rejectButton">
                      Reject
                  </button>
            </div>
        </div>
    </div>
    <main>
        <h1>dms-logchain</h1>
        <h3>dms-logchain-home</h3>
        <ul>/options
            <li><a href="/about.html">what is</a></li>
            <li><a href="/newUid.html">new deadman</a></li>
            <li><a href="/login.html">returning deadman</a></li>
            <li><a href="/watchlist.html">uid watchlist</a></li>
            <li><a id="strata" href="/history.html">view my strata</a></li>            
            <li><a id="subsequence" href="/following.html">view my subsequence</a></li>
            <li><a href="/findEntry.html">find entry</a></li>
            <li><a href="/newEntry.html">add new entry</a></li>
        </ul>
        <div class="buttons">
          <button id="log">checkin</button><br /><br />
          <button id="mine">mine entries</button><br /><br />
          <button id="lode">lode uids</button><br /><br />
        </div>
        <div id="logoutput"></div>
    </main>
    <div class="windows">
      <h3>latest log</h3>
      <iframe id="latestlog" src="/latestlog" title="description"></iframe>
      <h3>cache</h3>
      <iframe id="cache" src="/cache" title="description"></iframe>
    </div>
    <script src="./script.js"></script>
    <script type="text/javascript">
    const consentBox = document.getElementById("consentBox");
    const acceptBtn = document.querySelector(".consentButton");
    const rejectBtn = document.querySelector(".rejectButton");
    const mineBtn = document.getElementById("mine");
    const lodeBtn = document.getElementById("lode");
    const checkinBtn = document.getElementById("log");

    acceptBtn.onclick = () => {
        document.cookie = "cookieby=dms-logchain; max-age=" + 60 * 60 * 24 * 30;
        if (document.cookie) {
            consentBox.classList.add("hide");
        } else {
            alert
                ("Cookie can't be set! Please"+
                  " unblock this site from the cookie"+
                  " setting of your browser.");
        }
    };

    rejectBtn.onclick = () => {
        alert(
            "Cookies rejected. functionality will be limited.");
        consentBox.classList.add("hide");
    };
    mineBtn.onclick = () => {
        mineEntries();
        findLogIdx(getCookieValue('lastGuid'));
    };

    lodeBtn.onclick = () => {
      lodeUIDs();
      mineEntries();
      findLogIdx(getCookieValue('lastGuid'));
    };

    checkinBtn.onclick = () => {
      findLogIdx(getCookieValue('lastGuid'));
      mineEntries();      
      checkin();
      mineEntries();
      findLogIdx(getCookieValue('lastGuid'));
    };
    let checkCookie = document.cookie.indexOf("cookieby=dms-logchain");
    checkCookie !== -1 ? consentBox.classList.add("hide") : consentBox.classList.remove("hide");
    
    const lastGuidCookie = getCookieValue('lastGuid');
    const strataElement = document.getElementById("strata");    
    let uidCookie = document.cookie.indexOf("lastGuid");
    uidCookie !== -1 ? strataElement.setAttribute("href", "/history.html?uid="+lastGuidCookie) : strataElement.setAttribute("href", "#");
    const subsequenceElement = document.getElementById("subsequence");
    uidCookie !== -1 ? subsequenceElement.setAttribute("href", "/following.html?uid="+lastGuidCookie) : subsequenceElement.setAttribute("href", "#");
    
    const latestlog = document.getElementById('latestlog');
    const cache = document.getElementById('cache');
    latestlog.onload = function() {
      latestlog.style.height = latestlog.contentWindow.document.body.scrollHeight + 'px';
    };
    cache.onload = function() {
      cache.style.height = cache.contentWindow.document.body.scrollHeight + 'px';
    };
    </script>
  </body>
</html>

